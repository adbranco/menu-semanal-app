<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificador de Men√∫s</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üë®‚Äçüç≥</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createClient } = supabase;

        const ANTHROPIC_API_KEY = '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';

        const supabaseClient = createClient(
            'https://onqdchjbxpqzydfbimpj.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ucWRjaGpieHBxenlkZmJpbXBqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwMDM3NTksImV4cCI6MjA4NjU3OTc1OX0.9Kh_bD1suRC-b0WmwdWBxPCCL3xd4EIsN2buFR5DI5M'
        );

        // Iconos SVG
        const ChefHatIcon = () => (
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
            </svg>
        );

        const CalendarIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
        );

        const ShoppingCartIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
        );

        const HistoryIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const PlusIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
            </svg>
        );

        const EditIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
        );

        const TrashIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        );

        const DownloadIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
        );

        const UsersIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
        );

        const CopyIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
        );

        const SparklesIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
            </svg>
        );

        const PhotoIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
        );

        const LinkIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
            </svg>
        );

        const DocumentTextIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
        );

        const MealPlannerApp = () => {
            const [activeTab, setActiveTab] = useState('planner');
            const [recipes, setRecipes] = useState([]);
            const [weekPlan, setWeekPlan] = useState({
                monday: { lunch: { recipe: null, diners: 3 }, dinner: { recipe: null, diners: 5 }, special: '' },
                tuesday: { lunch: { recipe: null, diners: 3 }, dinner: { recipe: null, diners: 5 }, special: '' },
                wednesday: { lunch: { recipe: null, diners: 3 }, dinner: { recipe: null, diners: 5 }, special: '' },
                thursday: { lunch: { recipe: null, diners: 3 }, dinner: { recipe: null, diners: 5 }, special: '' },
                friday: { lunch: { recipe: null, diners: 3 }, dinner: { recipe: null, diners: 5 }, special: '' },
                saturday: { lunch: { recipe: null, diners: 5 }, dinner: { recipe: null, diners: 5 }, special: '' },
                sunday: { lunch: { recipe: null, diners: 5 }, dinner: { recipe: null, diners: 5 }, special: '' }
            });
            const [currentWeekId, setCurrentWeekId] = useState('');
            const [weekHistory, setWeekHistory] = useState([]);
            const [season, setSeason] = useState('invierno');
            const [showRecipeForm, setShowRecipeForm] = useState(false);
            const [showImportModal, setShowImportModal] = useState(false);
            const [importType, setImportType] = useState('');
            const [importLoading, setImportLoading] = useState(false);
            const [importData, setImportData] = useState('');
            const [importedRecipe, setImportedRecipe] = useState(null);
            const [editingRecipe, setEditingRecipe] = useState(null);
            const [newRecipe, setNewRecipe] = useState({
                nombre: '',
                temporada: 'all',
                tipo: 'batch',
                raciones: 3,
                ingredientes: []
            });
            const [loading, setLoading] = useState(true);
            const [saving, setSaving] = useState(false);

            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            const dayNames = {
                monday: 'Lunes',
                tuesday: 'Martes',
                wednesday: 'Mi√©rcoles',
                thursday: 'Jueves',
                friday: 'Viernes',
                saturday: 'S√°bado',
                sunday: 'Domingo'
            };

            function getWeekId(date) {
                const d = new Date(date);
                d.setHours(0, 0, 0, 0);
                d.setDate(d.getDate() + 4 - (d.getDay() || 7));
                const yearStart = new Date(d.getFullYear(), 0, 1);
                const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
                return d.getFullYear() + '-W' + weekNo.toString().padStart(2, '0');
            }

            useEffect(() => {
                const init = async () => {
                    const weekId = getWeekId(new Date());
                    setCurrentWeekId(weekId);
                    await loadData(weekId);
                };
                init();
            }, []);

            async function loadData(weekId) {
                setLoading(true);
                try {
                    const { data: recipesData, error: recipesError } = await supabaseClient
                        .from('recipes')
                        .select('*')
                        .order('id', { ascending: true });

                    if (recipesError) throw recipesError;
                    setRecipes(recipesData || []);

                    const { data: menuData, error: menuError } = await supabaseClient
                        .from('weekly_menus')
                        .select('*')
                        .eq('week_id', weekId)
                        .single();

                    if (menuData && !menuError) {
                        setWeekPlan(menuData.plan);
                    }

                    const { data: historyData, error: historyError } = await supabaseClient
                        .from('weekly_menus')
                        .select('*')
                        .order('week_id', { ascending: false })
                        .limit(52);

                    if (historyData && !historyError) {
                        setWeekHistory(historyData.map(item => ({
                            weekId: item.week_id,
                            date: item.updated_at,
                            plan: item.plan
                        })));
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                    alert('Error al cargar datos: ' + error.message);
                }
                setLoading(false);
            }

            async function saveCurrentWeek() {
                if (!currentWeekId) return;
                setSaving(true);
                try {
                    const { error } = await supabaseClient
                        .from('weekly_menus')
                        .upsert({
                            week_id: currentWeekId,
                            plan: weekPlan,
                            updated_at: new Date().toISOString()
                        }, {
                            onConflict: 'week_id'
                        });

                    if (error) throw error;

                    const { data: historyData } = await supabaseClient
                        .from('weekly_menus')
                        .select('*')
                        .order('week_id', { ascending: false })
                        .limit(52);

                    if (historyData) {
                        setWeekHistory(historyData.map(item => ({
                            weekId: item.week_id,
                            date: item.updated_at,
                            plan: item.plan
                        })));
                    }
                } catch (error) {
                    console.error('Error saving week:', error);
                }
                setSaving(false);
            }

            useEffect(() => {
                if (!loading && currentWeekId) {
                    const timer = setTimeout(() => {
                        saveCurrentWeek();
                    }, 1000);
                    return () => clearTimeout(timer);
                }
            }, [weekPlan, currentWeekId, loading]);

            async function importRecipeWithAI() {
                setImportLoading(true);
                try {
                    let prompt = '';
                    
                    if (importType === 'url') {
                        prompt = `Extrae la receta de esta URL: ${importData}

Responde SOLO con un JSON en este formato exacto:
{
  "nombre": "Nombre de la receta",
  "temporada": "all|verano|invierno",
  "tipo": "batch|momento",
  "raciones": 3,
  "ingredientes": [
    {"name": "Ingrediente", "amount": 100, "unit": "g", "category": "frescos|proteinas|despensa"}
  ]
}`;
                    } else if (importType === 'text') {
                        prompt = `A partir de esta descripci√≥n de receta, extrae los ingredientes:

${importData}

Responde SOLO con un JSON en este formato exacto:
{
  "nombre": "Nombre de la receta",
  "temporada": "all|verano|invierno",
  "tipo": "batch|momento",
  "raciones": 3,
  "ingredientes": [
    {"name": "Ingrediente", "amount": 100, "unit": "g", "category": "frescos|proteinas|despensa"}
  ]
}

Clasifica ingredientes:
- frescos: verduras, frutas
- proteinas: carnes, pescados, huevos, quesos
- despensa: pasta, arroz, conservas, especias`;
                    }

                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': ANTHROPIC_API_KEY,
                            'anthropic-version': '2023-06-01'
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 2000,
                            messages: [{
                                role: 'user',
                                content: prompt
                            }]
                        })
                    });

                    const data = await response.json();
                    const text = data.content[0].text;
                    const cleanJson = text.replace(/```json|```/g, '').trim();
                    const recipeData = JSON.parse(cleanJson);
                    
                    setImportedRecipe(recipeData);
                } catch (error) {
                    console.error('Error importing recipe:', error);
                    alert('Error al importar receta: ' + error.message);
                }
                setImportLoading(false);
            }

            async function importRecipeFromImage(file) {
                setImportLoading(true);
                try {
                    const base64 = await new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = () => resolve(reader.result.split(',')[1]);
                        reader.onerror = reject;
                        reader.readAsDataURL(file);
                    });

                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': ANTHROPIC_API_KEY,
                            'anthropic-version': '2023-06-01'
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 2000,
                            messages: [{
                                role: 'user',
                                content: [
                                    {
                                        type: 'image',
                                        source: {
                                            type: 'base64',
                                            media_type: file.type,
                                            data: base64
                                        }
                                    },
                                    {
                                        type: 'text',
                                        text: `Analiza esta imagen de receta y extrae los ingredientes.

Responde SOLO con un JSON en este formato exacto:
{
  "nombre": "Nombre de la receta",
  "temporada": "all|verano|invierno",
  "tipo": "batch|momento",
  "raciones": 3,
  "ingredientes": [
    {"name": "Ingrediente", "amount": 100, "unit": "g", "category": "frescos|proteinas|despensa"}
  ]
}

Clasifica ingredientes:
- frescos: verduras, frutas
- proteinas: carnes, pescados, huevos, quesos
- despensa: pasta, arroz, conservas, especias`
                                    }
                                ]
                            }]
                        })
                    });

                    const data = await response.json();
                    const text = data.content[0].text;
                    const cleanJson = text.replace(/```json|```/g, '').trim();
                    const recipeData = JSON.parse(cleanJson);
                    
                    setImportedRecipe(recipeData);
                } catch (error) {
                    console.error('Error importing from image:', error);
                    alert('Error al importar desde imagen: ' + error.message);
                }
                setImportLoading(false);
            }

            const generateShoppingList = () => {
                const list = { frescos: {}, proteinas: {}, despensa: {} };
                
                days.forEach(day => {
                    ['lunch', 'dinner'].forEach(meal => {
                        const mealData = weekPlan[day][meal];
                        if (mealData.recipe) {
                            const recipe = recipes.find(r => r.id === mealData.recipe);
                            if (recipe) {
                                const scale = mealData.diners / recipe.raciones;
                                recipe.ingredientes.forEach(ing => {
                                    const category = ing.category;
                                    const key = ing.name + ' (' + ing.unit + ')';
                                    if (!list[category][key]) {
                                        list[category][key] = 0;
                                    }
                                    list[category][key] += ing.amount * scale;
                                });
                            }
                        }
                    });
                });

                return list;
            };

            const exportToCalendar = () => {
                let icsContent = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Meal Planner//ES\n';
                
                days.forEach((day, index) => {
                    const date = new Date();
                    date.setDate(date.getDate() + index);
                    const dateStr = date.toISOString().split('T')[0].replace(/-/g, '');
                    
                    ['lunch', 'dinner'].forEach(meal => {
                        const mealData = weekPlan[day][meal];
                        if (mealData.recipe) {
                            const recipe = recipes.find(r => r.id === mealData.recipe);
                            if (recipe) {
                                const time = meal === 'lunch' ? '140000' : '210000';
                                icsContent += 'BEGIN:VEVENT\n';
                                icsContent += 'DTSTART:' + dateStr + 'T' + time + '\n';
                                icsContent += 'SUMMARY:' + (meal === 'lunch' ? 'Comida' : 'Cena') + ': ' + recipe.nombre + '\n';
                                icsContent += 'DESCRIPTION:' + mealData.diners + ' personas\n';
                                icsContent += 'END:VEVENT\n';
                            }
                        }
                    });
                });
                
                icsContent += 'END:VCALENDAR';
                
                const blob = new Blob([icsContent], { type: 'text/calendar' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'menu-semanal.ics';
                a.click();
            };

            const addIngredientToNewRecipe = () => {
                setNewRecipe({
                    ...newRecipe,
                    ingredientes: [...newRecipe.ingredientes, { name: '', amount: 0, unit: 'g', category: 'frescos' }]
                });
            };

            const saveRecipe = async () => {
                try {
                    if (editingRecipe) {
                        const { error } = await supabaseClient
                            .from('recipes')
                            .update({
                                nombre: newRecipe.nombre,
                                temporada: newRecipe.temporada,
                                tipo: newRecipe.tipo,
                                raciones: newRecipe.raciones,
                                ingredientes: newRecipe.ingredientes
                            })
                            .eq('id', editingRecipe.id);

                        if (error) throw error;
                    } else {
                        const { error } = await supabaseClient
                            .from('recipes')
                            .insert([{
                                nombre: newRecipe.nombre,
                                temporada: newRecipe.temporada,
                                tipo: newRecipe.tipo,
                                raciones: newRecipe.raciones,
                                ingredientes: newRecipe.ingredientes
                            }]);

                        if (error) throw error;
                    }

                    await loadData(currentWeekId);
                    setShowRecipeForm(false);
                    setEditingRecipe(null);
                    setNewRecipe({ nombre: '', temporada: 'all', tipo: 'batch', raciones: 3, ingredientes: [] });
                } catch (error) {
                    console.error('Error saving recipe:', error);
                    alert('Error al guardar receta: ' + error.message);
                }
            };

            const saveImportedRecipe = async () => {
                try {
                    const { error } = await supabaseClient
                        .from('recipes')
                        .insert([importedRecipe]);

                    if (error) throw error;

                    await loadData(currentWeekId);
                    setShowImportModal(false);
                    setImportedRecipe(null);
                    setImportData('');
                    setImportType('');
                    alert('¬°Receta importada con √©xito!');
                } catch (error) {
                    console.error('Error saving imported recipe:', error);
                    alert('Error al guardar receta: ' + error.message);
                }
            };

            const deleteRecipe = async (id) => {
                if (confirm('¬øEliminar esta receta?')) {
                    try {
                        const { error } = await supabaseClient
                            .from('recipes')
                            .delete()
                            .eq('id', id);

                        if (error) throw error;
                        await loadData(currentWeekId);
                    } catch (error) {
                        console.error('Error deleting recipe:', error);
                        alert('Error al eliminar receta: ' + error.message);
                    }
                }
            };

            const loadWeekFromHistory = (historyWeek) => {
                if (confirm('¬øCargar el men√∫ de la semana ' + historyWeek.weekId + '?')) {
                    setWeekPlan(historyWeek.plan);
                }
            };

            const getLastYearWeek = () => {
                const date = new Date();
                date.setFullYear(date.getFullYear() - 1);
                return getWeekId(date);
            };

            const lastYearWeek = weekHistory.find(w => w.weekId === getLastYearWeek());
            const filteredRecipes = recipes.filter(r => r.temporada === 'all' || r.temporada === season);
            const shoppingList = generateShoppingList();

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-orange-50 to-amber-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="w-12 h-12 border-4 border-orange-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                            <p className="text-gray-600">Cargando datos...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-orange-50 to-amber-50 p-4">
                    <div className="max-w-7xl mx-auto">
                        <header className="bg-white rounded-lg shadow-md p-6 mb-6">
                            <div className="flex items-center justify-between flex-wrap gap-4">
                                <div className="flex items-center gap-3">
                                    <div className="text-4xl">üë®‚Äçüç≥</div>
                                    <div>
                                        <h1 className="text-3xl font-bold text-gray-800">Planificador de Men√∫s</h1>
                                        <p className="text-gray-600">Organiza tu semana con batch cooking ¬∑ Semana {currentWeekId}</p>
                                    </div>
                                </div>
                                <div className="flex gap-2 items-center">
                                    {saving && <span className="text-sm text-gray-500">Guardando...</span>}
                                    <select 
                                        value={season} 
                                        onChange={(e) => setSeason(e.target.value)}
                                        className="px-4 py-2 rounded-lg border border-gray-300 bg-white"
                                    >
                                        <option value="verano">üåû Primavera/Verano</option>
                                        <option value="invierno">‚ùÑÔ∏è Oto√±o/Invierno</option>
                                    </select>
                                </div>
                            </div>
                            
                            {lastYearWeek && (
                                <div className="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center justify-between flex-wrap gap-2">
                                    <div className="flex items-center gap-2">
                                        <HistoryIcon />
                                        <span className="text-sm text-blue-800">
                                            üí° Hace un a√±o: {Object.values(lastYearWeek.plan).slice(0, 3).map(day => {
                                                const recipe = recipes.find(r => r.id === day.lunch.recipe);
                                                return recipe ? recipe.nombre : null;
                                            }).filter(Boolean).join(', ')}...
                                        </span>
                                    </div>
                                    <button
                                        onClick={() => loadWeekFromHistory(lastYearWeek)}
                                        className="text-sm px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700"
                                    >
                                        Usar este men√∫
                                    </button>
                                </div>
                            )}
                        </header>

                        <div className="flex gap-4 mb-6 flex-wrap">
                            <button
                                onClick={() => setActiveTab('planner')}
                                className={'flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition ' + 
                                    (activeTab === 'planner' ? 'bg-orange-600 text-white' : 'bg-white text-gray-700 hover:bg-orange-100')}
                            >
                                <CalendarIcon />
                                Planificador
                            </button>
                            <button
                                onClick={() => setActiveTab('recipes')}
                                className={'flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition ' +
                                    (activeTab === 'recipes' ? 'bg-orange-600 text-white' : 'bg-white text-gray-700 hover:bg-orange-100')}
                            >
                                <ChefHatIcon />
                                Recetas ({recipes.length})
                            </button>
                            <button
                                onClick={() => setActiveTab('shopping')}
                                className={'flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition ' +
                                    (activeTab === 'shopping' ? 'bg-orange-600 text-white' : 'bg-white text-gray-700 hover:bg-orange-100')}
                            >
                                <ShoppingCartIcon />
                                Lista de Compra
                            </button>
                            <button
                                onClick={() => setActiveTab('history')}
                                className={'flex items-center gap-2 px-6 py-3 rounded-lg font-semibold transition ' +
                                    (activeTab === 'history' ? 'bg-orange-600 text-white' : 'bg-white text-gray-700 hover:bg-orange-100')}
                            >
                                <HistoryIcon />
                                Hist√≥rico
                            </button>
                        </div>

                        {activeTab === 'planner' && (
                            <div className="bg-white rounded-lg shadow-md p-6">
                                <div className="flex justify-between items-center mb-6 flex-wrap gap-4">
                                    <h2 className="text-2xl font-bold text-gray-800">Men√∫ Semanal</h2>
                                    <button
                                        onClick={exportToCalendar}
                                        className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
                                    >
                                        <DownloadIcon />
                                        Exportar a Calendar
                                    </button>
                                </div>
                                
                                <div className="space-y-4">
                                    {days.map(day => (
                                        <div key={day} className="border border-gray-200 rounded-lg p-4">
                                            <div className="flex items-center justify-between mb-3 flex-wrap gap-2">
                                                <h3 className="text-lg font-bold text-gray-800">{dayNames[day]}</h3>
                                                <input
                                                    type="text"
                                                    placeholder="Notas (ej: comer fuera)"
                                                    value={weekPlan[day].special}
                                                    onChange={(e) => setWeekPlan({
                                                        ...weekPlan,
                                                        [day]: { ...weekPlan[day], special: e.target.value }
                                                    })}
                                                    className="px-3 py-1 border border-gray-300 rounded text-sm"
                                                />
                                            </div>
                                            
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div className="border-l-4 border-amber-500 pl-3">
                                                    <div className="flex items-center justify-between mb-2">
                                                        <span className="font-semibold text-gray-700">üçΩÔ∏è Comida</span>
                                                        <div className="flex items-center gap-2">
                                                            <UsersIcon />
                                                            <input
                                                                type="number"
                                                                value={weekPlan[day].lunch.diners}
                                                                onChange={(e) => setWeekPlan({
                                                                    ...weekPlan,
                                                                    [day]: {
                                                                        ...weekPlan[day],
                                                                        lunch: { ...weekPlan[day].lunch, diners: parseInt(e.target.value) }
                                                                    }
                                                                })}
                                                                className="w-16 px-2 py-1 border border-gray-300 rounded text-sm"
                                                            />
                                                        </div>
                                                    </div>
                                                    <select
                                                        value={weekPlan[day].lunch.recipe || ''}
                                                        onChange={(e) => setWeekPlan({
                                                            ...weekPlan,
                                                            [day]: {
                                                                ...weekPlan[day],
                                                                lunch: { ...weekPlan[day].lunch, recipe: parseInt(e.target.value) || null }
                                                            }
                                                        })}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded"
                                                    >
                                                        <option value="">Seleccionar receta...</option>
                                                        {filteredRecipes.map(recipe => (
                                                            <option key={recipe.id} value={recipe.id}>
                                                                {recipe.nombre} {recipe.tipo === 'batch' && 'üîÑ'}
                                                            </option>
                                                        ))}
                                                    </select>
                                                </div>
                                                
                                                <div className="border-l-4 border-blue-500 pl-3">
                                                    <div className="flex items-center justify-between mb-2">
                                                        <span className="font-semibold text-gray-700">üåô Cena</span>
                                                        <div className="flex items-center gap-2">
                                                            <UsersIcon />
                                                            <input
                                                                type="number"
                                                                value={weekPlan[day].dinner.diners}
                                                                onChange={(e) => setWeekPlan({
                                                                    ...weekPlan,
                                                                    [day]: {
                                                                        ...weekPlan[day],
                                                                        dinner: { ...weekPlan[day].dinner, diners: parseInt(e.target.value) }
                                                                    }
                                                                })}
                                                                className="w-16 px-2 py-1 border border-gray-300 rounded text-sm"
                                                            />
                                                        </div>
                                                    </div>
                                                    <select
                                                        value={weekPlan[day].dinner.recipe || ''}
                                                        onChange={(e) => setWeekPlan({
                                                            ...weekPlan,
                                                            [day]: {
                                                                ...weekPlan[day],
                                                                dinner: { ...weekPlan[day].dinner, recipe: parseInt(e.target.value) || null }
                                                            }
                                                        })}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded"
                                                    >
                                                        <option value="">Seleccionar receta...</option>
                                                        {filteredRecipes.map(recipe => (
                                                            <option key={recipe.id} value={recipe.id}>
                                                                {recipe.nombre} {recipe.tipo === 'batch' && 'üîÑ'}
                                                            </option>
                                                        ))}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'recipes' && (
                            <div className="bg-white rounded-lg shadow-md p-6">
                                <div className="flex justify-between items-center mb-6 flex-wrap gap-4">
                                    <h2 className="text-2xl font-bold text-gray-800">Mis Recetas ({recipes.length})</h2>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => setShowImportModal(true)}
                                            className="flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700"
                                        >
                                            <SparklesIcon />
                                            Importar con IA
                                        </button>
                                        <button
                                            onClick={() => {
                                                setShowRecipeForm(true);
                                                setEditingRecipe(null);
                                                setNewRecipe({ nombre: '', temporada: 'all', tipo: 'batch', raciones: 3, ingredientes: [] });
                                            }}
                                            className="flex items-center gap-2 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700"
                                        >
                                            <PlusIcon />
                                            Nueva Receta
                                        </button>
                                    </div>
                                </div>

                                {showImportModal && (
                                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                        <div className="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6">
                                            <h3 className="text-2xl font-bold mb-4">Importar Receta con IA</h3>
                                            
                                            {!importType && !importedRecipe && (
                                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                    <button
                                                        onClick={() => setImportType('photo')}
                                                        className="p-6 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition"
                                                    >
                                                        <div className="flex justify-center mb-2"><PhotoIcon /></div>
                                                        <div className="mt-2 font-semibold">Subir Foto</div>
                                                        <div className="text-sm text-gray-600 mt-1">De una receta</div>
                                                    </button>
                                                    <button
                                                        onClick={() => setImportType('url')}
                                                        className="p-6 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition"
                                                    >
                                                        <div className="flex justify-center mb-2"><LinkIcon /></div>
                                                        <div className="mt-2 font-semibold">URL Web</div>
                                                        <div className="text-sm text-gray-600 mt-1">De cualquier sitio</div>
                                                    </button>
                                                    <button
                                                        onClick={() => setImportType('text')}
                                                        className="p-6 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition"
                                                    >
                                                        <div className="flex justify-center mb-2"><DocumentTextIcon /></div>
                                                        <div className="mt-2 font-semibold">Descripci√≥n</div>
                                                        <div className="text-sm text-gray-600 mt-1">Escribe la receta</div>
                                                    </button>
                                                </div>
                                            )}

                                            {importType === 'photo' && !importedRecipe && (
                                                <div>
                                                    <input
                                                        type="file"
                                                        accept="image/*"
                                                        onChange={(e) => {
                                                            if (e.target.files[0]) {
                                                                importRecipeFromImage(e.target.files[0]);
                                                            }
                                                        }}
                                                        className="w-full p-4 border-2 border-dashed border-gray-300 rounded-lg"
                                                    />
                                                </div>
                                            )}

                                            {importType === 'url' && !importedRecipe && (
                                                <div>
                                                    <input
                                                        type="text"
                                                        placeholder="https://ejemplo.com/receta"
                                                        value={importData}
                                                        onChange={(e) => setImportData(e.target.value)}
                                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4"
                                                    />
                                                    <button
                                                        onClick={importRecipeWithAI}
                                                        disabled={!importData || importLoading}
                                                        className="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300"
                                                    >
                                                        {importLoading ? 'Procesando...' : 'Importar'}
                                                    </button>
                                                </div>
                                            )}

                                            {importType === 'text' && !importedRecipe && (
                                                <div>
                                                    <textarea
                                                        placeholder="Describe la receta o pega el texto..."
                                                        value={importData}
                                                        onChange={(e) => setImportData(e.target.value)}
                                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4 h-40"
                                                    />
                                                    <button
                                                        onClick={importRecipeWithAI}
                                                        disabled={!importData || importLoading}
                                                        className="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300"
                                                    >
                                                        {importLoading ? 'Procesando...' : 'Importar'}
                                                    </button>
                                                </div>
                                            )}

                                            {importLoading && (
                                                <div className="text-center py-8">
                                                    <div className="w-12 h-12 border-4 border-purple-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                                                    <p className="text-gray-600">Analizando con IA...</p>
                                                </div>
                                            )}

                                            {importedRecipe && (
                                                <div>
                                                    <h4 className="font-bold text-lg mb-4">Vista Previa de la Receta</h4>
                                                    <div className="bg-gray-50 p-4 rounded-lg mb-4">
                                                        <div className="font-semibold text-xl mb-2">{importedRecipe.nombre}</div>
                                                        <div className="text-sm text-gray-600 mb-4">
                                                            {importedRecipe.temporada} ¬∑ {importedRecipe.tipo} ¬∑ {importedRecipe.raciones} raciones
                                                        </div>
                                                        <div className="text-sm">
                                                            <strong>Ingredientes:</strong>
                                                            <ul className="mt-2 space-y-1">
                                                                {importedRecipe.ingredientes.map((ing, idx) => (
                                                                    <li key={idx}>
                                                                        {ing.name}: {ing.amount} {ing.unit} ({ing.category})
                                                                    </li>
                                                                ))}
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <button
                                                            onClick={saveImportedRecipe}
                                                            className="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
                                                        >
                                                            Guardar Receta
                                                        </button>
                                                        <button
                                                            onClick={() => setImportedRecipe(null)}
                                                            className="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400"
                                                        >
                                                            Editar
                                                        </button>
                                                    </div>
                                                </div>
                                            )}

                                            <button
                                                onClick={() => {
                                                    setShowImportModal(false);
                                                    setImportType('');
                                                    setImportData('');
                                                    setImportedRecipe(null);
                                                }}
                                                className="mt-4 w-full px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400"
                                            >
                                                Cerrar
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {showRecipeForm && (
                                    <div className="mb-6 p-4 border-2 border-orange-200 rounded-lg bg-orange-50">
                                        <h3 className="text-lg font-bold mb-4">{editingRecipe ? 'Editar' : 'Nueva'} Receta</h3>
                                        
                                        <div className="space-y-4">
                                            <input
                                                type="text"
                                                placeholder="Nombre de la receta"
                                                value={newRecipe.nombre}
                                                onChange={(e) => setNewRecipe({ ...newRecipe, nombre: e.target.value })}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                                            />
                                            
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <select
                                                    value={newRecipe.temporada}
                                                    onChange={(e) => setNewRecipe({ ...newRecipe, temporada: e.target.value })}
                                                    className="px-4 py-2 border border-gray-300 rounded-lg"
                                                >
                                                    <option value="all">Todo el a√±o</option>
                                                    <option value="verano">Primavera/Verano</option>
                                                    <option value="invierno">Oto√±o/Invierno</option>
                                                </select>
                                                
                                                <select
                                                    value={newRecipe.tipo}
                                                    onChange={(e) => setNewRecipe({ ...newRecipe, tipo: e.target.value })}
                                                    className="px-4 py-2 border border-gray-300 rounded-lg"
                                                >
                                                    <option value="batch">Batch Cooking</option>
                                                    <option value="momento">Al momento</option>
                                                </select>
                                                
                                                <input
                                                    type="number"
                                                    placeholder="Raciones"
                                                    value={newRecipe.raciones}
                                                    onChange={(e) => setNewRecipe({ ...newRecipe, raciones: parseInt(e.target.value) })}
                                                    className="px-4 py-2 border border-gray-300 rounded-lg"
                                                />
                                            </div>

                                            <div>
                                                <div className="flex justify-between items-center mb-2">
                                                    <h4 className="font-semibold">Ingredientes</h4>
                                                    <button
                                                        onClick={addIngredientToNewRecipe}
                                                        className="text-sm text-orange-600 hover:text-orange-700"
                                                    >
                                                        + A√±adir ingrediente
                                                    </button>
                                                </div>
                                                
                                                {newRecipe.ingredientes.map((ing, idx) => (
                                                    <div key={idx} className="grid grid-cols-5 gap-2 mb-2">
                                                        <input
                                                            type="text"
                                                            placeholder="Ingrediente"
                                                            value={ing.name}
                                                            onChange={(e) => {
                                                                const newIngs = [...newRecipe.ingredientes];
                                                                newIngs[idx].name = e.target.value;
                                                                setNewRecipe({ ...newRecipe, ingredientes: newIngs });
                                                            }}
                                                            className="col-span-2 px-3 py-2 border border-gray-300 rounded"
                                                        />
                                                        <input
                                                            type="number"
                                                            placeholder="Cantidad"
                                                            value={ing.amount}
                                                            onChange={(e) => {
                                                                const newIngs = [...newRecipe.ingredientes];
                                                                newIngs[idx].amount = parseFloat(e.target.value);
                                                                setNewRecipe({ ...newRecipe, ingredientes: newIngs });
                                                            }}
                                                            className="px-3 py-2 border border-gray-300 rounded"
                                                        />
                                                        <select
                                                            value={ing.unit}
                                                            onChange={(e) => {
                                                                const newIngs = [...newRecipe.ingredientes];
                                                                newIngs[idx].unit = e.target.value;
                                                                setNewRecipe({ ...newRecipe, ingredientes: newIngs });
                                                            }}
                                                            className="px-3 py-2 border border-gray-300 rounded"
                                                        >
                                                            <option value="g">g</option>
                                                            <option value="kg">kg</option>
                                                            <option value="ml">ml</option>
                                                            <option value="l">l</option>
                                                            <option value="unidad">unidad</option>
                                                            <option value="dientes">dientes</option>
                                                            <option value="lata">lata</option>
                                                            <option value="manojo">manojo</option>
                                                            <option value="lonchas">lonchas</option>
                                                            <option value="pizca">pizca</option>
                                                            <option value="cucharada">cucharada</option>
                                                        </select>
                                                        <select
                                                            value={ing.category}
                                                            onChange={(e) => {
                                                                const newIngs = [...newRecipe.ingredientes];
                                                                newIngs[idx].category = e.target.value;
                                                                setNewRecipe({ ...newRecipe, ingredientes: newIngs });
                                                            }}
                                                            className="px-3 py-2 border border-gray-300 rounded"
                                                        >
                                                            <option value="frescos">Frescos</option>
                                                            <option value="proteinas">Prote√≠nas</option>
                                                            <option value="despensa">Despensa</option>
                                                        </select>
                                                    </div>
                                                ))}
                                            </div>

                                            <div className="flex gap-2">
                                                <button
                                                    onClick={saveRecipe}
                                                    className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
                                                >
                                                    Guardar
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setShowRecipeForm(false);
                                                        setEditingRecipe(null);
                                                    }}
                                                    className="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400"
                                                >
                                                    Cancelar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {recipes.map(recipe => (
                                        <div key={recipe.id} className="border border-gray-200 rounded-lg p-4">
                                            <div className="flex justify-between items-start mb-2">
                                                <div>
                                                    <h3 className="font-bold text-lg">{recipe.nombre}</h3>
                                                    <div className="flex gap-2 mt-1 flex-wrap">
                                                        <span className="text-xs px-2 py-1 bg-gray-100 rounded">
                                                            {recipe.temporada === 'all' ? 'üåç Todo el a√±o' : recipe.temporada === 'verano' ? '‚òÄÔ∏è Verano' : '‚ùÑÔ∏è Invierno'}
                                                        </span>
                                                        <span className="text-xs px-2 py-1 bg-gray-100 rounded">
                                                            {recipe.tipo === 'batch' ? 'üîÑ Batch' : '‚ö° Al momento'}
                                                        </span>
                                                        <span className="text-xs px-2 py-1 bg-gray-100 rounded">
                                                            üë• {recipe.raciones} pers.
                                                        </span>
                                                    </div>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => {
                                                            setEditingRecipe(recipe);
                                                            setNewRecipe({
                                                                nombre: recipe.nombre,
                                                                temporada: recipe.temporada,
                                                                tipo: recipe.tipo,
                                                                raciones: recipe.raciones,
                                                                ingredientes: recipe.ingredientes
                                                            });
                                                            setShowRecipeForm(true);
                                                        }}
                                                        className="text-blue-600 hover:text-blue-700"
                                                    >
                                                        <EditIcon />
                                                    </button>
                                                    <button
                                                        onClick={() => deleteRecipe(recipe.id)}
                                                        className="text-red-600 hover:text-red-700"
                                                    >
                                                        <TrashIcon />
                                                    </button>
                                                </div>
                                            </div>
                                            <div className="text-sm text-gray-600">
                                                <strong>Ingredientes:</strong> {recipe.ingredientes.map(i => i.name).join(', ')}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'shopping' && (
                            <div className="bg-white rounded-lg shadow-md p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">Lista de la Compra</h2>
                                
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="border-2 border-green-200 rounded-lg p-4 bg-green-50">
                                        <h3 className="text-lg font-bold text-green-800 mb-3">
                                            ü•¨ Frescos (WhatsApp)
                                        </h3>
                                        <ul className="space-y-2">
                                            {Object.entries(shoppingList.frescos).map(([item, amount]) => (
                                                <li key={item} className="text-sm">
                                                    <strong>{item}:</strong> {Math.ceil(amount)}
                                                </li>
                                            ))}
                                            {Object.keys(shoppingList.frescos).length === 0 && (
                                                <li className="text-sm text-gray-500">No hay frescos esta semana</li>
                                            )}
                                        </ul>
                                    </div>

                                    <div className="border-2 border-red-200 rounded-lg p-4 bg-red-50">
                                        <h3 className="text-lg font-bold text-red-800 mb-3">
                                            ü•© Prote√≠nas (Tel√©fono)
                                        </h3>
                                        <ul className="space-y-2">
                                            {Object.entries(shoppingList.proteinas).map(([item, amount]) => (
                                                <li key={item} className="text-sm">
                                                    <strong>{item}:</strong> {Math.ceil(amount)}
                                                </li>
                                            ))}
                                            {Object.keys(shoppingList.proteinas).length === 0 && (
                                                <li className="text-sm text-gray-500">No hay prote√≠nas esta semana</li>
                                            )}
                                        </ul>
                                    </div>

                                    <div className="border-2 border-amber-200 rounded-lg p-4 bg-amber-50">
                                        <h3 className="text-lg font-bold text-amber-800 mb-3">
                                            üè™ Despensa (Online)
                                        </h3>
                                        <ul className="space-y-2">
                                            {Object.entries(shoppingList.despensa).map(([item, amount]) => (
                                                <li key={item} className="text-sm">
                                                    <strong>{item}:</strong> {Math.ceil(amount)}
                                                </li>
                                            ))}
                                            {Object.keys(shoppingList.despensa).length === 0 && (
                                                <li className="text-sm text-gray-500">No hay despensa esta semana</li>
                                            )}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'history' && (
                            <div className="bg-white rounded-lg shadow-md p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">Hist√≥rico de Men√∫s</h2>
                                
                                {weekHistory.length === 0 ? (
                                    <p className="text-gray-500 text-center py-8">A√∫n no hay men√∫s guardados en el hist√≥rico</p>
                                ) : (
                                    <div className="space-y-4">
                                        {weekHistory.map(week => (
                                            <div key={week.weekId} className="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                                                <div className="flex justify-between items-start mb-3 flex-wrap gap-2">
                                                    <div>
                                                        <h3 className="font-bold text-lg">Semana {week.weekId}</h3>
                                                        <p className="text-sm text-gray-500">
                                                            Guardado: {new Date(week.date).toLocaleDateString('es-ES')}
                                                        </p>
                                                    </div>
                                                    <button
                                                        onClick={() => loadWeekFromHistory(week)}
                                                        className="flex items-center gap-2 px-3 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 text-sm"
                                                    >
                                                        <CopyIcon />
                                                        Usar este men√∫
                                                    </button>
                                                </div>
                                                
                                                <div className="grid grid-cols-2 md:grid-cols-7 gap-2 text-xs">
                                                    {days.map(day => {
                                                        const lunchRecipe = recipes.find(r => r.id === week.plan[day].lunch.recipe);
                                                        const dinnerRecipe = recipes.find(r => r.id === week.plan[day].dinner.recipe);
                                                        return (
                                                            <div key={day} className="border border-gray-100 rounded p-2">
                                                                <div className="font-semibold mb-1">{dayNames[day].slice(0, 3)}</div>
                                                                <div className="text-gray-600">
                                                                    {lunchRecipe ? 'üçΩÔ∏è ' + lunchRecipe.nombre.slice(0, 12) + '...' : '‚Äî'}
                                                                </div>
                                                                <div className="text-gray-600 mt-1">
                                                                    {dinnerRecipe ? 'üåô ' + dinnerRecipe.nombre.slice(0, 12) + '...' : '‚Äî'}
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<MealPlannerApp />, document.getElementById('root'));
    </script>
</body>
</html>
